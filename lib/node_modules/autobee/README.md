# Autobee

Multi-writer key-value store combining Autobase + Hyperbee.

Similar to autodrive but for structured key-value data instead of files.

## Usage

```javascript
const { create_autobee } = require('autobee')
const Corestore = require('corestore')

const store = new Corestore('./storage')

const autobee = create_autobee({
  store,
  bootstrap: null,
  opts: {
    keyEncoding: 'utf-8',
    valueEncoding: 'json'
  }
})

await autobee.ready()

await autobee.put('my-key', { some: 'value' })

const result = await autobee.get('my-key')
console.log(result.value)

await autobee.del('my-key')
```

## API

### create_autobee(options)

Create a new autobee instance.

Options:
- `store` - Corestore instance
- `bootstrap` - Bootstrap key (null for new, or key to join existing)
- `opts.keyEncoding` - Key encoding (default: 'utf-8')
- `opts.valueEncoding` - Value encoding (default: 'json')

### Properties

- `autobee.base` - The underlying Autobase instance
- `autobee.view` - The underlying Hyperbee instance
- `autobee.version` - Current version number
- `autobee.id` - String id of the bee
- `autobee.key` - Public key buffer
- `autobee.discovery_key` - Discovery key buffer
- `autobee.writable` - Boolean, true if we can write
- `autobee.readable` - Boolean, true if we can read
- `autobee.core` - The underlying Hypercore

### Methods

#### await autobee.ready()
Wait for autobee to be ready.

#### await autobee.close()
Close the autobee and its underlying structures.

#### await autobee.put(key, value)
Store a key-value pair.

#### await autobee.get(key, [opts])
Get a value by key. Returns `{ seq, key, value }` or null.

#### await autobee.del(key)
Delete a key.

#### await autobee.get_by_seq(seq, [opts])
Get an entry by its sequence number.

#### await autobee.peek(range, [opts])
Get the first value in a range quickly.

#### autobee.create_read_stream([range], [opts])
Create a read stream for iterating entries.

Range options:
- `gte` - Greater than or equal
- `gt` - Greater than
- `lte` - Less than or equal
- `lt` - Less than

Options:
- `reverse` - Reverse order
- `limit` - Max entries

#### autobee.create_history_stream([opts])
Stream all historical operations.

Options:
- `live` - Keep stream open for new data
- `reverse` - Newest to oldest
- `gte`, `gt`, `lte`, `lt` - Sequence range
- `limit` - Max entries

#### autobee.create_diff_stream(version, [range], [opts])
Stream changes between two versions.

#### autobee.watch([range], [opts])
Watch for changes in a range.

```javascript
const watcher = autobee.watch()
await watcher.ready()

for await (const [current, previous] of watcher) {
  console.log('changed:', current.version)
}

await watcher.close()
```

#### await autobee.get_and_watch(key, [opts])
Get and watch a specific key.

```javascript
const watcher = await autobee.get_and_watch('my-key')
console.log(watcher.node.value)

watcher.on('update', () => {
  console.log('new value:', watcher.node.value)
})

await watcher.close()
```

#### autobee.checkout(version, [opts])
Get a read-only snapshot of a previous version.

#### autobee.snapshot([opts])
Get a snapshot of the current version.

#### autobee.sub(prefix, [opts])
Create a sub-database with a prefix.

```javascript
const sub = autobee.sub('settings')
await sub.put('theme', 'dark')
const val = await sub.get('theme')
```

#### autobee.batch([opts])
Create an atomic batch for multiple operations.

```javascript
const batch = autobee.batch()
await batch.put('key1', 'val1')
await batch.put('key2', 'val2')
await batch.flush()
```

#### await autobee.add_writer(key, [is_indexer])
Add a writer to the autobee.

#### await autobee.update()
Force an update to sync with peers.

#### autobee.replicate(stream, [opts])
Replicate with a peer.

### Events

- `update` - Emitted when the view updates
- `put` - Emitted when a put is applied
- `del` - Emitted when a delete is applied
- `writer-added` - Emitted when a writer is added

For more info about hyperbee and autobase check out these:
https://github.com/holepunchto/hyperbee
https://github.com/holepunchto/autobase
