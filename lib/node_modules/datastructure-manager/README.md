# Datastructure Manager

A unified API for managing Hypercore-based data structures with built-in multi-device pairing.

## What it does

- Dynamically register and initialize data structures (autobase, autodrive)
- Manage writer keys automatically
- Pair devices seamlessly to share data structures

## Quick Start

```javascript
const datastructure_manager = require('datastructure-manager')
const ds_manager = datastructure_manager()

// Register your structures
ds_manager.register({
  name: 'posts',
  namespace: 'app-posts',
  type: 'autobase',
  store: corestore,
  data: { encoding: 'json', name: 'view' }
})

// Initialize everything
await ds_manager.init_all()

// Use them
const posts = ds_manager.get('posts')
await posts.append({ type: 'post', content: 'Hello!' })
```

## Core Methods

**register(config)** - Add a structure before initialization

```javascript
ds_manager.register({
  name: 'files',              // unique identifier
  namespace: 'app-files',     // storage namespace
  type: 'autodrive',          // 'autobase' or 'autodrive'
  store: corestore           // corestore instance
})
```

**init(name, key?)** - Initialize one structure

```javascript
await ds_manager.init('posts')              // create new
await ds_manager.init('posts', existing_key) // join existing
```

**init_all()** - Initialize all registered structures at once

```javascript
const { metadata, files, profile } = await ds_manager.init_all()
```

**get(name)** - Retrieve an initialized structure

```javascript
const posts = ds_manager.get('posts')
```

## Pairing (Multi-Device)

**Device 1** - Create invite:
```javascript
const { invite_code } = await ds_manager.create_invite_with_pairing(swarm, 'files')
console.log('Share:', invite_code)
```

**Device 2** - Join with invite:
```javascript
const result = await ds_manager.join_with_invite_and_init(invite_code, swarm, store)
// All structures automatically initialized with shared keys
```

## Structure Types

**Autobase** - Multi-writer append-only log
```javascript
{ type: 'autobase', data: { encoding: 'json', name: 'view' } }

await autobase.append({ data: 'entry' })
await autobase.update()
```

**Autodrive** - Multi-writer file system
```javascript
{ type: 'autodrive' }

await drive.put('/file.txt', Buffer.from('content'))
const data = await drive.get('/file.txt')
```

## Complete Example

```javascript
const Corestore = require('corestore')
const store = new Corestore('./data')
await store.ready()

const ds_manager = datastructure_manager()

// Setup structures
const STRUCTURES = [
  { name: 'metadata', namespace: 'app-meta', type: 'autobase', store },
  { name: 'files', namespace: 'app-files', type: 'autodrive', store }
]

STRUCTURES.forEach(config => ds_manager.register(config))

// First device - create
await ds_manager.init_all()

// Second device - join via pairing
const result = await ds_manager.join_with_invite_and_init(invite_code, swarm, store)

// Use your structures
const files = ds_manager.get('files')
await files.put('/hello.txt', Buffer.from('Hello!'))
```

## Utility Methods

```javascript
ds_manager.get_key('posts')              // get discovery key
ds_manager.get_names()                   // list all structure names
ds_manager.get_config('posts')           // get structure config
ds_manager.get_all_writer_keys()         // get all writer keys
ds_manager.add_writer('posts', key)      // add writer to structure
```

## Key Points

- Each structure needs a unique namespace
- Provide corestore during registration
- Writer keys are managed automatically
- Pairing exchanges all structure keys at once