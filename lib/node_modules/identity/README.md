# Identity Module

App-independent networking and device management for P2P applications.

## What it does

- Manages keypairs for identity
- Handles multi-device pairing
- Sets up P2P networking (Hyperswarm, DHT relay, WebRTC)
- Logs device events

**Note:** This is infrastructure only - no app-specific stuff like data structures.

## Quick Start

```javascript
const identity = require('identity')
const b4a = require('b4a')

const vault = identity({ name: 'my-app' })

// Start networking (your app provides topic and storage name)
const { store, swarm } = await vault.start_networking({
  name: 'user-device',
  topic: b4a.from('my-app-topic', 'hex'),
  store_name: 'my-app-data'
})

// Use store and swarm for your data structures
```

## Core API

**start_networking(options)** - Set up P2P networking (browser only)

```javascript
const { store, swarm, dht, cleanup } = await vault.start_networking({
  name: 'peer-name',
  topic: Buffer.from('...'),           // Required: your app's swarm topic
  store_name: 'my-app-data',          // Required: storage namespace
  get_primary_key: () => '...',       // Optional: primary structure key
  get_primary_structure: () => {...}  // Optional: primary structure
})
```

Returns networking instances ready to use.

## Device Management

```javascript
// Log device event
await vault.log_event(events_drive, 'add', {
  metadata_writer: '...',
  profile_writer: '...'
})

// Get all device events
const events = await vault.get_events(events_drive)

// Get paired devices
const devices = await vault.get_paired_devices(events_drive)

// Remove a device
await vault.remove_device(events_drive, writer_key)

// Debug data
const data = await vault.get_raw_data(events_drive)
```

## Setup Methods

Configure the vault with your app's components:

```javascript
vault.set_events_drive(drive, store_instance, setup_callback)
vault.set_ds_manager(manager)
vault.set_pairing_manager(manager)
vault.set_swarm(swarm)
vault.set_dht(dht)
vault.set_keypair(keypair)
```

## Getters

```javascript
const events_drive = vault.get_events_drive()
const events_store = vault.get_events_store()
const store = vault.get_store()
const swarm = vault.get_swarm()
const dht = vault.get_dht()
const keypair = vault.get_keypair()
const config = vault.config
```

## Events

```javascript
vault.on_update(callback)
```

## How it fits together

```
Your App
├── Provides swarm topic
├── Provides storage namespace
└── Manages app data structures
    ↓
Identity Module
├── Networking infrastructure
├── Device pairing
└── Keypair management
```

## Complete Example

```javascript
const identity = require('identity')
const b4a = require('b4a')

// Setup
const vault = identity({ 
  name: 'blog-app',
  relay: 'ws://custom-relay.com'  // optional
})

// App-specific topic
const BLOG_TOPIC = b4a.from('blog-app-v1', 'hex')

// Start networking
const { store, swarm, dht, cleanup } = await vault.start_networking({
  name: 'user-laptop',
  topic: BLOG_TOPIC,
  store_name: 'blog-data',
  get_primary_key: () => blog.get_key('posts'),
  get_primary_structure: () => blog.get('posts')
})

// Now build your app with store and swarm
// ...

// Clean up when done
cleanup()
```

## Key Points

- Browser-focused (uses WebRTC + DHT relay)
- Your app provides the swarm topic and storage namespace
- No profile or app data management - just infrastructure
- Device pairing works with any data structure setup