module.exports = function article_viewer (data) {
  const content_html = data.content
    .split('\n\n')
    .map(parse_block)
    .join('')

  function parse_block (block) {
    block = block.trim()
    if (!block) return ''

    if (block.startsWith('# ')) return `<h1>${block.slice(2)}</h1>`
    if (block.startsWith('## ')) return `<h2>${block.slice(3)}</h2>`
    if (block.startsWith('### ')) return `<h3>${block.slice(4)}</h3>`

    if (block.startsWith('- ')) {
      const items = block.split('\n').map(format_list_item).join('')
      return `<ul>${items}</ul>`
    }

    let p = block

    p = p.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    p = p.replace(/\*(.*?)\*/g, '<em>$1</em>')
    p = p.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2">$1</a>')

    return `<p>${p}</p>`
  }

  function format_list_item (line) {
    return `<li>${line.replace(/^- /, '')}</li>`
  }

  return `
    <article class="article-container">
      <header class="article-header">
        <h1 class="article-title">${data.title}</h1>
        <div class="article-meta">
          <span>By <strong>${data.author}</strong></span> â€¢ <span>${data.date}</span>
        </div>
      </header>
      <div class="article-body">${content_html}</div>
    </article>
  `
}

module.exports.parser = require('./content_parser')
